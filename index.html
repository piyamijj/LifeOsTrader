<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOs Broker Terminal</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0b0e11; color: #e9eaeb; margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: auto; }
        .panel { background: #1e2329; border-radius: 12px; padding: 20px; border: 1px solid #333; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        h2, h3 { color: #f0b90b; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        
        /* AI Mesaj AlanÄ± */
        .ai-box { background: #2b2f36; border-left: 5px solid #f0b90b; padding: 15px; font-style: italic; color: #d1d1d1; margin-bottom: 15px; min-height: 50px; line-height: 1.5; }
        
        /* Strateji KartlarÄ± */
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .card { background: #000; border: 1px solid #444; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; transition: 0.3s; }
        .card:hover { border-color: #f0b90b; transform: translateY(-3px); }
        .action { font-weight: bold; font-size: 1.2rem; display: block; margin-top: 8px; }
        .AL { color: #2ebd85; } .SAT { color: #f6465d; } .BEKLE { color: #848e9c; }

        /* Soru ve Butonlar */
        textarea { width: 100%; background: #2b3139; color: white; border: 1px solid #444; border-radius: 8px; padding: 12px; box-sizing: border-box; font-size: 1rem; margin-top: 10px; }
        .main-btn { width: 100%; padding: 18px; background: #f0b90b; color: #000; border: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 15px; }
        .auto-btn { width: 100%; padding: 12px; background: #333; color: #fff; border: 1px solid #555; border-radius: 8px; margin-top: 10px; cursor: pointer; }
        .active-auto { background: #f6465d; animation: pulse 2s infinite; }

        /* Pop-up */
        #modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background: #1e2329; border: 2px solid #f0b90b; padding: 25px; border-radius: 15px; z-index: 1000; box-shadow: 0 0 50px rgba(0,0,0,0.8); text-align: center; }
        .exec-btn { background: #f0b90b; color: #000; padding: 15px; width: 100%; border: none; font-weight: bold; border-radius: 8px; margin-top: 20px; font-size: 1.1rem; cursor: pointer; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h2>ğŸ›°ï¸ LifeOs RADAR</h2>
        <div id="aiResponse" class="ai-box">"KomutanÄ±m, emirlerinizi ve sorularÄ±nÄ±zÄ± bekliyorum..."</div>
        <ul id="radarItems" style="list-style: none; padding: 0; color: #848e9c; font-size: 0.9rem;"></ul>
    </div>

    <div class="panel">
        <h3>ğŸ¯ BROKER MASASI</h3>
        <div class="grid">
            <div class="card" onclick="openOrder('scalp')">
                SCALP (XAU)<br><span id="sc_act" class="BEKLE">BEKLE</span>
            </div>
            <div class="card" onclick="openOrder('day')">
                GÃœNLÃœK (EUR)<br><span id="dy_act" class="BEKLE">BEKLE</span>
            </div>
            <div class="card" onclick="openOrder('swing')">
                SWING (BTC)<br><span id="sw_act" class="BEKLE">BEKLE</span>
            </div>
        </div>
    </div>

    <div class="panel">
        <textarea id="question" placeholder="LifeOs'a sor: Piyasa nereye gidiyor?"></textarea>
        <button id="runBtn" class="main-btn" onclick="analyze()">ANALÄ°Z ET VE HABER VER</button>
        <button id="autoBtn" class="auto-btn" onclick="toggleAuto()">NÃ–BETÃ‡Ä° MODU: KAPALI</button>
    </div>
</div>

<div id="modal">
    <h2 id="modalTitle">EMRÄ° ONAYLA</h2>
    <div id="modalDetails" style="font-size: 1.2rem; margin: 20px 0; color: #fff; line-height: 1.8;"></div>
    <button id="confirmBtn" class="exec-btn" onclick="sendTrade()">ğŸš€ KANALA VE CEPHEYE GÃ–NDER</button>
    <button onclick="closeModal()" style="background:none; color:#848e9c; border:none; margin-top:15px; cursor:pointer;">Ä°ptal Et</button>
</div>

<script>
    let data = null;
    let selectedTrade = null;
    let autoTimer = null;

    async function analyze() {
        const btn = document.getElementById('runBtn');
        const q = document.getElementById('question').value;
        btn.innerText = "LifeOs HESAPLIYOR...";
        btn.disabled = true;

        try {
            const res = await fetch('/api/analiz', {
                method: 'POST',
                body: JSON.stringify({ question: q })
            });
            data = await res.json();

            document.getElementById('aiResponse').innerText = `"${data.aiResponse}"`;
            document.getElementById('radarItems').innerHTML = data.radarElements.map(e => `<li>â€¢ ${e}</li>`).join('');
            
            updateCard('sc', data.strategies.scalp);
            updateCard('dy', data.strategies.day);
            updateCard('sw', data.strategies.swing);

        } catch (e) {
            alert("BaÄŸlantÄ± HatasÄ±: " + e.message);
        } finally {
            btn.innerText = "ANALÄ°Z ET VE HABER VER";
            btn.disabled = false;
        }
    }

    function updateCard(id, strat) {
        const el = document.getElementById(id + '_act');
        el.innerText = strat.action;
        el.className = 'action ' + strat.action;
    }

    function openOrder(type) {
        if (!data) return alert("Ã–nce analiz yapmalÄ±sÄ±n komutanÄ±m!");
        selectedTrade = data.strategies[type];
        
        document.getElementById('modalTitle').innerText = selectedTrade.pair + " OPERASYONU";
        document.getElementById('modalDetails').innerHTML = `
            YÃ–N: <b class="${selectedTrade.action}">${selectedTrade.action}</b><br>
            GÄ°RÄ°Å: ${selectedTrade.price}<br>
            HEDEF: ${selectedTrade.tp}<br>
            STOP: ${selectedTrade.sl}
        `;
        document.getElementById('modal').style.display = 'block';
        
        const cBtn = document.getElementById('confirmBtn');
        cBtn.style.display = selectedTrade.action === 'BEKLE' ? 'none' : 'block';
    }

    async function sendTrade() {
        const btn = document.getElementById('confirmBtn');
        btn.innerText = "KOMUT Ä°LETÄ°LÄ°YOR...";
        btn.disabled = true;

        try {
            const res = await fetch('/api/trade', {
                method: 'POST',
                body: JSON.stringify(selectedTrade)
            });
            const result = await res.json();
            alert(result.msg);
            closeModal();
        } catch (e) {
            alert("Emir hatasÄ±: " + e.message);
        } finally {
            btn.innerText = "ğŸš€ KANALA VE CEPHEYE GÃ–NDER";
            btn.disabled = false;
        }
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    function toggleAuto() {
        const btn = document.getElementById('autoBtn');
        if (autoTimer) {
            clearInterval(autoTimer);
            autoTimer = null;
            btn.innerText = "NÃ–BETÃ‡Ä° MODU: KAPALI";
            btn.classList.remove('active-auto');
        } else {
            analyze();
            autoTimer = setInterval(analyze, 60000);
            btn.innerText = "NÃ–BETÃ‡Ä° MODU: AKTÄ°F";
            btn.classList.add('active-auto');
            alert("NÃ¶betÃ§i Modu devrede! Her dakika piyasayÄ± tarayÄ±p rapor vereceÄŸim.");
        }
    }
</script>
</body>
</html>
